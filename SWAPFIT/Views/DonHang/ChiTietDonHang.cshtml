@model SWAPFIT.Models.DonHang

<div class="container mt-4">

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <h3 class="mb-3 fw-bold">🧾 Đơn hàng #@Model.MaDonHang</h3>

            <div class="row mb-2">
                <div class="col-md-6">
                    <p><strong>Người mua:</strong> @Model.NguoiMua?.HoTen</p>
                    <p><strong>Địa chỉ giao hàng:</strong> @Model.DiaChiGiaoHang</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Ngày đặt:</strong> @Model.NgayDat.ToString("dd/MM/yyyy")</p>
                    <p>
                        <strong>Tổng tiền:</strong>
                        <span class="text-danger fw-bold">@Model.TongTien.ToString("N0") đ</span>
                    </p>
                </div>
            </div>

            <span class="badge
                @(Model.TrangThai == "Chờ xác nhận" ? "bg-warning text-dark" :
<<<<<<< HEAD
                                                      Model.TrangThai == "Đang giao" ? "bg-info" :
                                                      Model.TrangThai == "Đã hoàn thành" ? "bg-success" : "bg-danger")
=======
                                    Model.TrangThai == "Đang giao" ? "bg-info" :
                                    Model.TrangThai == "Đã hoàn thành" ? "bg-success" : "bg-danger")
>>>>>>> cff493713bfe5280dbb98db99eb56a2baceef7ff
                px-3 py-2 fs-6">
                @Model.TrangThai
            </span>
        </div>
    </div>

    <!-- Sản phẩm -->
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-light fw-bold fs-5">
            Sản phẩm trong đơn hàng
        </div>
        <div class="card-body p-0">
            <table class="table table-striped align-middle">
                <thead>
                    <tr class="text-center">
                        <th style="width:80px;">Ảnh</th>
                        <th class="text-start">Sản phẩm</th>
                        <th style="width:90px;">Số lượng</th>
                        <th class="text-end" style="width:120px;">Giá</th>
                        <th class="text-end" style="width:140px;">Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
<<<<<<< HEAD
                    @foreach (var ct in Model.ChiTietDonHangs)
                    {
                        var anhSanPham = "/images/no-image.png"; // Ảnh mặc định
                        var firstImg = ct.BaiViet?.AnhBaiViets?.OrderBy(a => a.MaAnh).FirstOrDefault();
                        if (firstImg != null)
                        {
                            anhSanPham = firstImg.DuongDan.StartsWith("/")
                            ? firstImg.DuongDan
                            : "/images/products/" + firstImg.DuongDan;
                        }
                        <tr>
                            <td>
                                <img src="@Url.Content(anhSanPham)"
                                     alt="@ct.BaiViet?.TieuDe"
                                     class="rounded shadow-sm"
                                     style="width: 80px; height: 80px; object-fit: cover;"
                                     onerror="this.src='/images/no-image.png'" />
                            </td>
                            <td class="fw-medium">
                                <div>@(ct.BaiViet?.TieuDe ?? "<em class='text-muted'>Sản phẩm đã xóa</em>")</div>
                                @if (ct.BaiViet == null)
                                {
                                    <small class="text-danger">Sản phẩm không còn tồn tại</small>
                                }
                            </td>
                            <td class="text-center fw-bold">@ct.SoLuong</td>
                            <td class="text-end">@ct.Gia.ToString("N0") đ</td>
                            <td class="text-end text-success fw-bold">@((ct.SoLuong * ct.Gia).ToString("N0")) đ</td>
                        </tr>
                    }

                </tbody>
=======
@foreach (var ct in Model.ChiTietDonHangs)
{
    // Lấy ảnh
    var anh = ct.BaiViet?.AnhBaiViets?.FirstOrDefault()?.DuongDan;
    if (string.IsNullOrWhiteSpace(anh))
    {
        anh = "/images/no-image.png";
    }
    else
    {
        anh = "/" + anh.TrimStart('~', '/');
    }

    // Xác định bài tặng hay bán
    bool laBaiTang = string.Equals(
        ct.BaiViet?.LoaiBaiDang?.Trim(),
        "Tặng",
        StringComparison.OrdinalIgnoreCase
    );

    decimal donGia = laBaiTang ? 0m : (ct.BaiViet?.GiaSanPham ?? 0m);
    decimal thanhTien = donGia * ct.SoLuong;

    <tr>
        <!-- ẢNH -->
        <td class="text-center align-middle" style="width:80px;">
            <img src="@Url.Content(anh)"
                 alt="@ct.BaiViet?.TieuDe"
                 class="img-thumbnail rounded"
                 style="width:60px;height:60px;object-fit:cover;" />
        </td>

        <!-- SẢN PHẨM -->
        <td class="align-middle">@ct.BaiViet?.TieuDe</td>

        <!-- SỐ LƯỢNG -->
        <td class="text-center align-middle">@ct.SoLuong</td>

        <!-- GIÁ -->
        <td class="text-end align-middle">
            @if (laBaiTang)
            {
                <span class="text-success fw-semibold">0 đ</span>
            }
            else
            {
                @donGia.ToString("N0") @: đ
            }
        </td>

        <!-- THÀNH TIỀN -->
        <td class="text-end align-middle fw-bold">
            @if (laBaiTang)
            {
                <span class="text-success">0 đ</span>
            }
            else
            {
                @thanhTien.ToString("N0") @: đ
            }
        </td>
    </tr>
}
</tbody>


>>>>>>> cff493713bfe5280dbb98db99eb56a2baceef7ff
            </table>

        </div>
    </div>

    <!-- Cập nhật trạng thái -->
    @if (Model.MaNguoiBan == Context.Session.GetInt32("MaNguoiDung"))
    {
        <div class="card shadow-sm border-0 p-4">
            <h5 class="fw-bold mb-3">Cập nhật trạng thái đơn hàng</h5>

            <form asp-action="CapNhatTrangThai" method="post" class="row g-3 align-items-end">
                <input type="hidden" name="id" value="@Model.MaDonHang" />

                <div class="col-md-4">
                    <select name="trangThai" class="form-select">
                        <option value="Chờ xác nhận" selected="@(Model.TrangThai == "Chờ xác nhận")">Chờ xác nhận</option>
                        <option value="Đang giao" selected="@(Model.TrangThai == "Đang giao")">Đang giao</option>
                        <option value="Đã hoàn thành" selected="@(Model.TrangThai == "Đã hoàn thành")">Đã hoàn thành</option>
                        <option value="Đã hủy" selected="@(Model.TrangThai == "Đã hủy")">Đã hủy</option>
                    </select>
                </div>

                <div class="col-md-3">
                    <button class="btn btn-primary px-4">💾 Lưu thay đổi</button>
                </div>
            </form>
        </div>
    }
</div>
<<<<<<< HEAD



@* @model SWAPFIT.Models.BaoCaoTaiKhoan

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    string tenNguoiBaoCao = Model.NguoiBaoCao?.HoTen ?? Model.NguoiBaoCao?.TenDangNhap ?? "Không rõ";
    string tenNguoiBiBaoCao = Model.NguoiBiBaoCao?.HoTen ?? Model.NguoiBiBaoCao?.TenDangNhap ?? "Không rõ";
    string trangThaiClass = Model.TrangThai switch
    {
        "DaXuLy" => "badge bg-success",
        "DangXuLy" => "badge bg-info",
        _ => "badge bg-warning text-dark"
    };
}

<div class="container py-4">
    <div class="mb-4">
        <h3 class="fw-bold text-primary">
            ⚠ Chi tiết báo cáo tài khoản
        </h3>
        <p class="text-muted">Xem thông tin đầy đủ của báo cáo này</p>
    </div>
    <div class="card shadow-sm border-0 rounded-3">
        <div class="card-header bg-light fw-semibold">
            Thông tin báo cáo
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label class="fw-semibold text-secondary">Người báo cáo:</label>
                <div class="fs-5">
                    👤 @tenNguoiBaoCao
                </div>
            </div>
            <div class="mb-3">
                <label class="fw-semibold text-secondary">Người bị báo cáo:</label>
                <div class="fs-5 text-danger">
                    🚫 @tenNguoiBiBaoCao
                </div>
            </div>
            <div class="mb-3">
                <label class="fw-semibold text-secondary">Thời gian báo cáo:</label>
                <div>
                    🕒 @Model.NgayTao.ToString("HH:mm dd/MM/yyyy")
                </div>
            </div>
            <div class="mb-3">
                <label class="fw-semibold text-secondary">Trạng thái:</label>
                <div>
                    <span class="@trangThaiClass px-3 py-1 rounded-pill">
                        @Model.TrangThai
                    </span>
                </div>
            </div>
            <hr />
            <div class="mb-3">
                <label class="fw-semibold text-secondary">Lý do báo cáo:</label>
                <p class="mt-1 fs-5">@Model.LyDo</p>
            </div>
            @if (!string.IsNullOrWhiteSpace(Model.MoTaChiTiet))
            {
                <div class="mb-3">
                    <label class="fw-semibold text-secondary">Mô tả chi tiết:</label>
                    <div class="alert alert-light border mt-1">
                        @Model.MoTaChiTiet
                    </div>
                </div>
            }
            <!-- Hiển thị các hình ảnh báo cáo -->
            @if (Model.BaoCaoTaiKhoanAnhs != null && Model.BaoCaoTaiKhoanAnhs.Any())
            {
                <div class="mb-4">
                    <label class="fw-semibold text-secondary fs-5">Hình ảnh làm bằng chứng:</label>
                    <div class="row g-3 mt-2">
                        @foreach (var anh in Model.BaoCaoTaiKhoanAnhs)
                        {
                            <div class="col-lg-4 col-md-6">
                                <!-- Đảm bảo đường dẫn đúng -->
                                <a href="@Url.Content(anh.DuongDan)" target="_blank">
                                    <img src="@Url.Content(anh.DuongDan)" class="img-fluid rounded shadow-sm border"
                                         style="max-height: 400px; object-fit: cover;" alt="Bằng chứng" />
                                </a>
                            </div>
                        }
                    </div>
                </div>
            }
            else
            {
                <p class="text-muted fst-italic">Không có hình ảnh nào được tải lên.</p>
            }
        </div>
    </div>
</div> *@
=======
>>>>>>> cff493713bfe5280dbb98db99eb56a2baceef7ff
