@model SWAPFIT.Models.GioHang
@{
    ViewData["Title"] = "Giỏ hàng";
    decimal tongTien = 0;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background-color: #f5f9f5;
    }

    .cart-container {
        max-width: 900px;
        margin: 40px auto;
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        padding: 30px;
    }

    .cart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #e2f3e2;
        margin-bottom: 20px;
        padding-bottom: 10px;
    }

        .cart-header h2 {
            color: #2e7d32;
            font-weight: 700;
        }

    .table th {
        background-color: #a5d6a7 !important;
        color: #1b5e20;
        font-weight: 600;
    }

    .table td {
        vertical-align: middle;
    }

    .btn-success {
        background-color: #43a047;
        border: none;
        transition: 0.3s;
    }

        .btn-success:hover {
            background-color: #2e7d32;
        }

    .btn-danger {
        background-color: #e57373;
        border: none;
        transition: 0.3s;
    }

        .btn-danger:hover {
            background-color: #c62828;
        }

    .alert {
        border-radius: 10px;
    }

    .empty-cart {
        text-align: center;
        padding: 40px 0;
        color: #757575;
    }

        .empty-cart a {
            color: #2e7d32;
            text-decoration: none;
            font-weight: 600;
        }

    .total-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #e8f5e9;
        border-radius: 12px;
        padding: 15px 20px;
        margin-top: 25px;
    }

    .product-img {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid #ddd;
    }
</style>

<div class="cart-container">
    <div class="cart-header">
        <h2>🛒 Giỏ hàng của bạn</h2>
        <a asp-controller="TinTuc" asp-action="ChoTang" class="btn btn-outline-success btn-sm">
            <i class="bi bi-arrow-left"></i> Tiếp tục mua sắm
        </a>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    @if (Model == null || Model.ChiTietGioHangs == null || !Model.ChiTietGioHangs.Any())
    {
<<<<<<< HEAD
        <div class="empty-cart">
            <img src="https://cdn-icons-png.flaticon.com/512/102/102661.png" width="90" alt="empty-cart" class="mb-3" />
=======
        if (TempData["DaDatHang"] != null)
        {
            <div class="empty-cart">
                <img src="https://cdn-icons-png.flaticon.com/512/845/845646.png" width="90" class="mb-3" />
                <h4 class="text-success">🎉 Đặt hàng thành công!</h4>
                <p>Đơn hàng của bạn đang chờ người bán xác nhận.</p>

                <a href="/DonHang/LichSuDonHang" class="btn btn-success">📦 Xem đơn hàng</a>
                <br /><br />
                <a href="/TinTuc/ChoTang" class="btn btn-outline-success">🛍 Tiếp tục mua sắm</a>
            </div>

            return;
        }

        <!-- GIỎ HÀNG TRỐNG BÌNH THƯỜNG -->
        <div class="empty-cart">
            <img src="https://cdn-icons-png.flaticon.com/512/102/102661.png" width="90" class="mb-3" />
>>>>>>> cff493713bfe5280dbb98db99eb56a2baceef7ff
            <p>Giỏ hàng của bạn đang trống.</p>
            <a asp-controller="TinTuc" asp-action="ChoTang" class="btn btn-outline-success btn-sm">
                <i class="bi bi-arrow-left"></i> Tiếp tục mua sắm
            </a>
        </div>
<<<<<<< HEAD
    }
=======

        return;
    }


>>>>>>> cff493713bfe5280dbb98db99eb56a2baceef7ff
    else
    {
        <table class="table table-hover align-middle text-center">
            <thead>
                <tr>
                    <th style="width: 300px;">Sản phẩm</th>
                    <th style="width: 120px;">Số lượng</th>
                    <th>Giá</th>
                    <th>Thành tiền</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
<<<<<<< HEAD
            @foreach (var item in Model.ChiTietGioHangs)
{
    if (item.BaiViet == null)
    {
        <tr><td colspan="5" class="text-danger">⚠️ Sản phẩm này không còn tồn tại!</td></tr>
        continue;
    }

    var thanhTien = (item.BaiViet.GiaSanPham ?? 0) * item.SoLuong;
    tongTien += thanhTien;

    <tr>
        <td class="text-start d-flex align-items-center gap-3">
            @{
                var anh = item.BaiViet.AnhBaiViets?.FirstOrDefault()?.DuongDan;
                var anhHienThi = string.IsNullOrEmpty(anh)
                ? "https://cdn-icons-png.flaticon.com/512/679/679720.png"
                : (anh.StartsWith("/") ? anh : "/" + anh);
            }

            <img src="@anhHienThi" alt="Ảnh sản phẩm" class="product-img" />
            <span class="fw-semibold">@item.BaiViet.TieuDe</span>
        </td>

        <td>
            <form asp-action="CapNhatSoLuong" method="post" class="d-flex justify-content-center align-items-center">
                <input type="hidden" name="maChiTiet" value="@item.MaChiTiet" />
                <input type="number"
                       name="soLuongMoi"
                       value="@item.SoLuong"
                       min="1"
                       max="@item.BaiViet.SoLuong"
                       class="form-control text-center"
                       style="width: 80px;"
                       onchange="this.form.submit()" />
            </form>
        </td>

        <td>@((item.BaiViet.GiaSanPham ?? 0).ToString("N0")) đ</td>
        <td class="text-success fw-bold">@thanhTien.ToString("N0") đ</td>

        <td>
            <form asp-action="XoaSanPham" method="post">
                <input type="hidden" name="maChiTiet" value="@item.MaChiTiet" />
                <button type="submit" class="btn btn-danger btn-sm">
                    <i class="bi bi-trash"></i> Xóa
                </button>
            </form>
        </td>
    </tr>
}

=======
                @foreach (var item in Model.ChiTietGioHangs)
                {
                    if (item.BaiViet == null)
                    {
                        <tr><td colspan="5" class="text-danger">⚠️ Sản phẩm này không còn tồn tại!</td></tr>
                        continue;
                    }

                    var thanhTien = (item.BaiViet.GiaSanPham ?? 0) * item.SoLuong;
                    tongTien += thanhTien;

                    <tr>
                        <td class="text-start d-flex align-items-center gap-3">
                            @{
                                var anh = item.BaiViet.AnhBaiViets?.FirstOrDefault()?.DuongDan;
                                var anhHienThi = string.IsNullOrEmpty(anh)
                                ? "https://cdn-icons-png.flaticon.com/512/679/679720.png"
                                : (anh.StartsWith("/") ? anh : "/" + anh);
                            }

                            <img src="@anhHienThi" alt="Ảnh sản phẩm" class="product-img" />

                            <span class="fw-semibold">@item.BaiViet.TieuDe</span>
                        </td>

                        <td>
                            <form asp-action="CapNhatSoLuong" method="post" class="d-flex justify-content-center align-items-center">
                                <input type="hidden" name="maChiTiet" value="@item.MaChiTiet" />
                                <input type="number"
                                       name="soLuongMoi"
                                       value="@item.SoLuong"
                                       min="1"
                                       max="@item.BaiViet.SoLuong"
                                       class="form-control text-center"
                                       style="width: 80px;"
                                       onchange="this.form.submit()" />
                            </form>
                        </td>

                        <td>@((item.BaiViet.GiaSanPham ?? 0).ToString("N0")) đ</td>
                        <td class="text-success fw-bold">@thanhTien.ToString("N0") đ</td>

                        <td>
                            <form asp-action="XoaSanPham" method="post">
                                <input type="hidden" name="maChiTiet" value="@item.MaChiTiet" />
                                <button type="submit" class="btn btn-danger btn-sm">
                                    <i class="bi bi-trash"></i> Xóa
                                </button>
                            </form>
                        </td>
                    </tr>
                }
>>>>>>> cff493713bfe5280dbb98db99eb56a2baceef7ff
            </tbody>
        </table>

        <div class="total-section">
            <h5 class="mb-0">Tổng cộng:</h5>
            <h4 class="text-success fw-bold mb-0">@tongTien.ToString("N0") đ</h4>
        </div>

        <div class="text-end mt-3">
            <form asp-controller="ThanhToan" asp-action="Index" method="get">
                <button type="submit" class="btn btn-success px-4 py-2">
                    🧾 Thanh toán ngay
                </button>
            </form>
        </div>
    }
</div>
