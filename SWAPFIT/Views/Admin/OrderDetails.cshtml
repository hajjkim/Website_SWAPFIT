@model SWAPFIT.Models.BaiViet
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Chi tiết bài đăng";
}

<div class="container mt-4 mb-5">
    <h3 class="mb-4 text-primary fw-bold">Chi tiết bài đăng</h3>

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h4 class="mb-3 text-success fw-bold">@Model.TieuDe</h4>

            <!-- NGƯỜI ĐĂNG – HIỂN THỊ ĐÚNG 100% DÙ TÀI KHOẢN BỊ XÓA -->
            <p class="mb-2">
                <strong>Người đăng:</strong>
                @{
                    var tenHienThi = "Tài khoản đã xóa";
                    if (Model.NguoiDung != null)
                    {
                        tenHienThi = !string.IsNullOrWhiteSpace(Model.NguoiDung.HoTen)
                        ? Model.NguoiDung.HoTen
                        : (!string.IsNullOrWhiteSpace(Model.NguoiDung.TenDangNhap)
                        ? Model.NguoiDung.TenDangNhap
                        : "Tài khoản đã xóa");
                    }
                }
                <span class="fw-bold">@tenHienThi</span>
                @if (Model.NguoiDung?.TenDangNhap != null &&
                                string.IsNullOrWhiteSpace(Model.NguoiDung.HoTen) == false &&
                                Model.NguoiDung.HoTen != Model.NguoiDung.TenDangNhap)
                {
                    <small class="text-muted">(@Model.NguoiDung.TenDangNhap)</small>
                }
            </p>

            <p><strong>Danh mục:</strong> @Model.DanhMuc?.TenDanhMuc</p>
            <p><strong>Loại bài:</strong> <span class="badge bg-info">@Model.LoaiBaiDang</span></p>
            <span class="text-danger fw-bold">@((Model.GiaSanPham ?? 0).ToString("N0")) ₫</span>         
            <p><strong>Số lượng:</strong> @Model.SoLuong</p>
            <p><strong>Ngày tạo:</strong> @Model.NgayTao?.ToString("HH:mm - dd/MM/yyyy")</p>

            <p>
                <strong>Trạng thái:</strong>
                <span class="badge @(Model.TrangThai == "Chờ duyệt" ? "bg-warning text-dark" :
                                                          Model.TrangThai == "Đang hiển thị" ? "bg-success" :
                                                          Model.TrangThai == "Từ chối" ? "bg-danger" :
                                                          Model.TrangThai == "Đã xóa" ? "bg-secondary" : "bg-primary")">
                    @Model.TrangThai
                </span>
            </p>

            <hr class="my-4">

            <p><strong>Mô tả chi tiết:</strong></p>
            <div class="border rounded p-3 bg-light mb-4">
                @if (!string.IsNullOrWhiteSpace(Model.NoiDung))
                {
                    @Html.Raw(Model.NoiDung.Replace("\n", "<br>"))
                }
                else
                {
                    <em class="text-muted">Chưa có nội dung mô tả</em>
                }
            </div>

            <!-- HÌNH ẢNH -->
            @if (Model.AnhBaiViets != null && Model.AnhBaiViets.Any())
            {
                <p class="mb-2"><strong>Hình ảnh bài viết:</strong></p>
                <div class="row g-3">
                    @foreach (var img in Model.AnhBaiViets)
                    {
                        <div class="col-md-4 col-6">
                            <a href="@img.DuongDan" target="_blank">
                                <img src="@img.DuongDan" class="img-fluid rounded border shadow-sm" alt="Ảnh bài viết" />
                            </a>
                        </div>
                    }
                </div>
            }
            else
            {
                <p class="text-muted mt-3">Bài viết chưa có hình ảnh.</p>
            }
        </div>
    </div>

    <!-- NÚT THAO TÁC -->
    <div class="d-flex flex-wrap gap-3 align-items-center">
        @if (Model.TrangThai == "Chờ duyệt")
        {
            <a asp-action="Duyet" asp-route-id="@Model.MaBaiViet" class="btn btn-success btn-lg">
                Duyệt bài
            </a>
            <a asp-action="TuChoi" asp-route-id="@Model.MaBaiViet" class="btn btn-warning btn-lg">
                Từ chối
            </a>
            <form asp-action="DeletePostAdmin" asp-route-id="@Model.MaBaiViet" method="post" class="d-inline">
                <button type="submit" class="btn btn-danger btn-lg"
                        onclick="return confirm('Bạn có chắc chắn muốn xóa bài viết này không?')">
                    Xóa bài
                </button>
            </form>
        }
        else
        {
            <div class="alert alert-info mb-0">
                Bài viết đã được <strong>@Model.TrangThai.ToLower()</strong>
            </div>
        }

        <a asp-action="Posts" class="btn btn-outline-secondary ms-auto">
            ← Quay lại danh sách bài viết
        </a>
    </div>
</div>